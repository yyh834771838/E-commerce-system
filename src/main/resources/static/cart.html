<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css.css" />
    <link href="/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <title>iCart HTML Version</title>
</head>
<style>
	.logo_img {
		height:60px;
		font-size:2.5rem;
		     color: #fafafa;
		     letter-spacing: 0;
		     text-shadow: 0px 1px 0px #999, 0px 2px 0px #888, 0px 3px 0px #777, 0px 4px 0px #666, 0px 5px 0px #555, 0px 6px 0px #444, 0px 7px 0px #333, 0px 8px 7px #001135;
		text-indent: 50px;
	}
</style>
<body>
<div class="menu">
<ul>
<li style="width:0px;"><a></a></li>
<li><a href="index.html" class="home">首页</a></li>
<li><a href="wishlist.html" class="wishlist">商城主页</a></li>
<li><a href="account.html" class="account">我的账户</a></li>
<li class="active"><a href="cart.html" class="cart">购物车</a></li>
<!--<li><a class="checkout">商品结算</a></li>-->
<!--<li class="active" style="float:right;"><a href="login.html" class="login">登陆/注册</a></li>-->
<li  style="float:right;" ><div id="top_page" class="login"></div></li>
</ul>
</div>

<div style="width:700px;margin:700 auto;">
    <div id="cart">
    <!-- <div class="heading">
	<a style="padding:8px;margin-left:-14px;">Shopping Cart</a><span style="font-size:14px;color:#fff;">&raquo;</span>
    <a><span id="cart_total">0 item(s) - $0.00</span></a>
	</div> -->
    <div class="content"></div>
	</div>  
	<div id="search">
    <div class="button-search"></div>
        <input type="text" name="filter_name" value="Search" style="height:32px;width:175px;" onkeydown="this.style.color = '#888';" />
    </div>

</div>

<div class="header">
<div class="logo_img">LOVESHOP</div></div>

<!--&lt;!&ndash; 商品分类 &ndash;&gt;-->
<!--<div id="menu">-->
<!--<ul>  -->
<!--<li><a href="#">衣装服饰</a>-->
<!--	<div>-->
<!--	<ul>	-->
<!--	<li><a href="default.htm">外套</a></li>-->
<!--	<li><a href="default.htm">裤子</a></li>-->
<!--	<li><a href="default.htm">鞋子</a></li>-->
<!--	<li><a href="default.htm">内衣</a></li>-->
<!--	</ul>-->
<!--	</div>-->
<!--</li>-->
<!--<li><a href="#">吃货圣地</a>-->
<!--	<div>-->
<!--	<ul>	-->
<!--	<li><a href="default.htm">酒乳饮品</a></li>-->
<!--	<li><a href="default.htm">蔬菜菌类</a></li>-->
<!--	<li><a href="default.htm">休闲食品</a></li>-->
<!--	<li><a href="default.htm">时令水果</a></li>-->
<!--	</ul>-->
<!--	</div>-->
<!--</li>-->
<!--<li><a href="index.html">电子设备</a>-->
<!--	<div>-->
<!--	<ul>	-->
<!--	<li><a href="default.htm">电脑</a></li>-->
<!--	<li><a href="default.htm">电视</a></li>-->
<!--	<li><a href="default.htm">手机</a></li>-->
<!--	<li><a href="default.htm">配件</a></li>-->
<!--	</ul>-->
<!--	</div>-->
<!--</li>-->
<!--<li><a href="index.html">生活用品</a>-->
<!--	<div>-->
<!--	<ul>	-->
<!--	<li><a href="default.htm">学习用品</a></li>-->
<!--	<li><a href="default.htm">体育用品</a></li>-->
<!--	<li><a href="default.htm">厨房用具</a></li>-->
<!--	<li><a href="default.htm">客厅摆式</a></li>-->
<!--	</ul>-->
<!--	</div>-->
<!--</li>-->
<!--</ul>-->
<!--</div>-->

<div style="width:1000px;margin: 0 auto;margin-top:10px;">
<div class="linktree">
        <a href="#">首页</a>
         &raquo; <a href="#">购物车</a>
    </div>
<h1 style="margin-top:-10px;">购物车&nbsp;</h1>

     <form action="#" method="post" id="basket">
      <div class="cart-info">
        <table>
          <thead>
            <tr>
              <td class="remove">选择</td>
              <td class="image">外观</td>
              <td class="name">产品名称</td>
              <td class="model">分类</td>
              <td class="quantity">数量</td>
              <td class="price">单价</td>
              <td class="total">总价</td>
              <td class="total">操作</td>
            </tr>
          </thead>
          <tbody id="tbody">
          </tbody>
        </table>
      </div>
    </form>

    <div class="buttons">
      <div class="left"><input type="checkbox" id="selectAll" onclick="checkAll()"/>全选</div>
      <div class="right"><a href="settlement.html" class="button" style="height:30px;width:120px;" ><span>结算</span></a></div>
      <div class="center"><a href="index.html" class="button" style="height:30px;width:120px;"><span>继续购物</span></a></div>
    </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="delModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">提示</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="del_id">
                <p>确认删除？</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="height:35px;">取消</button>
                <button type="button" class="btn btn-primary" onclick="doDelete()" style="height:35px;">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="editModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">提示</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit_id">
                <form class="form-horizontal">
                    <div class="form-group form-group-lg">
                        <label class="control-label col-lg-2">数量:</label>
                        <div class="col-lg-8">
                            <input type="text" name="num" id="num" class="form-control"
                                   placeholder="请输入数量">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="height:35px;">取消</button>
                <button type="button" class="btn btn-primary" onclick="doEdit()" style="height:35px;">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

</body>
<script src="jquery/jquery-3.4.1.min.js"></script>
<script src="/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
	<script type="text/javascript">
		//文件加载完毕后执行
		$("#selectAll").click(function(){//给全选按钮加上点击事件
			var xz = $(this).prop("checked");//判断全选按钮的选中状态
		    var ck = $(".select").prop("checked",xz);  //
		})
        var if_jump=''
        jQuery(function(){
            //页面加载完毕，就去数据库中获取数据
            //          /all 请求的地址
            var cookies=document.cookie.split(";");
            for(var i=0;i<cookies.length;i++)
            {
                var cookie=cookies[i].trim();
                if(cookie.indexOf("info")==0)
                {
                    var m=cookie.substring("info".length+1);
                    var m1=m.split("【");
                    m2=m1[1].split("】");
                }
            }
            jQuery.post("/all",{"name":m2[0]},function(rst) {
                for(var i=0;i<rst.length;i++){
                    jQuery.post("/chosen0",{"id":rst[i].id});
                }
            });
            jQuery.post("/all",{"name":m2[0]},function(rst){//处理响应的结果
                var body="";
                if_jump=rst[0].pro_id;
                for(var i=0;i<rst.length;i++)
                {
                    var json=rst[i];
                    body+="<tr>";
                    body+="<td class=\"select\"><input type=\"checkbox\" class=\"select\" id=\"check"+i+"\" onclick='check(\""+json.id+"\",\""+i+"\")'/></td>"
                    body+="<td class=\"image\"><a href=\"#\"><img src=\""+json.photo+"\" width=\"150\" height=\"75\" /></a></td>"
                    body+="<td class=\"name\"><a href=\"#\">"+json.name+"</a></td>"
                    body+="<td class=\"model\">"+json.class2_id+"</td>"
                    body+="<td>"+json.pro_number+"</td>";
                    body+="<td>"+json.pro_price+"</td>";
                    body+="<td>"+json.pro_number*json.pro_price+"</td>";
                    body+="<td>";
                    body+="<a href='#' onclick='showDelModal(\""+json.id+"\",\""+json.user_id+"\")'>删除</a>&nbsp;&nbsp;";
                    body+="<a href='#' onclick='showEditModal(" +
                        "\""+json.id+"\"," +
                        "\""+json.pro_number+"\")'>修改</a>";
                    body+="</td>"
                    body+="</tr>";
                }
                jQuery("#tbody").html(body);
            },"json");//表示返回数据的格式
        });

        //如果是通过function定义的方法必须在jquery外面写
        function showDelModal(id,name)
        {
            jQuery("#del_id").val(id);
            jQuery("#del_msg").html(name);
            jQuery("#delModal").modal("show");
        }
        function doDelete()
        {
            jQuery("#delModal").modal("hide");
            var id=jQuery("#del_id").val();
            //json格式的属性名称必须与后台对应
            jQuery.post("/delete",{"id":id},function(rst){
                alert(rst);
                //如果删除成功，重新加载数据
                if(rst=='删除成功')
                {
                    //重新加载本页面
                    location.reload();
                }
            });
        }
        function showEditModal(id,num)
        {
            jQuery("#edit_id").val(id);
            jQuery("#num").val(num);
            jQuery("#editModal").modal("show");
        }
        function doEdit() {
            jQuery("#editModal").modal("hide");
            //获取数据
            var id=jQuery("#edit_id").val();
            var pro_number=jQuery("#num").val();
            jQuery.post("/update",{"id":id,"pro_number":pro_number},function (rst) {
                alert(rst);
                if(rst=="修改成功")
                {
                    location.reload();
                }
            })
        }
        //判断购物车为空
        // function jump(){
        //     if(if_jump==''){
        //         alert("购物车为空！")
        //         location.reload();
        //     }
        //     Location.href="settlement.html";
        // }

        function check(id,i){
            var flag=jQuery("#check"+i).is(":checked");
            if(flag){
                jQuery.post("/chosen1",{"id":id});
            }
            else jQuery.post("/chosen0",{"id":id});
        }

        function checkAll(){
            jQuery.post("/all",{"name":m2[0]},function(rst) {
                var flag = jQuery("#selectAll").is(":checked");
                if(flag){
                    for(var i=0;i<rst.length;i++){
                        jQuery.post("/chosen1",{"id":rst[i].id});
                    }
                }
                else{
                    for(var i=0;i<rst.length;i++){
                        jQuery.post("/chosen0",{"id":rst[i].id});
                    }
                }
            });
        }
// 检测登陆
        $("#top_page").load("top.html");

</script>
</html>