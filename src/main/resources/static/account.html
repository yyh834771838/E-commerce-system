<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="css.css" >
	<link href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<title>网上购物商城</title>
</head>
<body>
<div class="menu">
<ul>
<li style="width:0px;"><a></a></li>
<li><a href="index.html" class="home">首页</a></li>
<li><a href="wishlist.html" class="wishlist">商城主页</a></li>
<li class="active"><a href="account.html" class="account">我的账户</a></li>
<li><a href="cart.html" class="cart">购物车</a></li>
	<!--li class="active" style="float:right;"><a href="login.html" class="login">登陆/注册</a></li-->
	<li  style="float:right;" ><div id="top_page" class="login"></div></li>
</ul>
</div>
<div style="width: 700px;">
	<div id="search">
	<div class="button-search"></div>
	    <input type="text" name="filter_name" value=""  onkeydown="this.style.color='#888' ;" />
	  </div>
</div>
<div class="header">
<div class="logo_img">LOVESHOP</div></div>


<div style="width:1000px;margin: 0 auto;margin-top:10px;">
<div id="column-right">
    <div class="box">
  <div class="box-heading_left">账号管理</div>
  <div class="box-content" style="background:none;border: solid 1px #E3E3E2;"><div class="box-category">
    <ul>
      	<li><a onclick="showInfo()">个人资料</a></li>
      	<li><a onclick="showAddr()">收货地址</a></li>
      	<li id="test"><a href="custom_order.html">个人交易信息</a></li>
		<script src="Script/getOrder.js">
			getStatus();
		</script>
      	<li><a href="#">个人成长信息</a></li>
		<li><a href="#">安全设置</a></li>
    </ul>
  </div>
</div>
</div>
</div>
	<div id="information" style="display: inline">
    <h2>我的账户</h2>
	<h4>亲爱的会员，填写真实信息，有助于好友找到你哦。</h4>
	<form action="#" >
		<div class="content">
			<ul>
				<li>
					昵称:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="u_name">
				</li>
				<br/>
				<li>
					密码:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="u_pwd">
				</li>
				<br/>
				<li>
					电话:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="u_tel">
				</li>
				<br/>
				<li>
					性别:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="u_sex">
				</li>
				<br/>
				<li>
					邮箱:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="u_email">
				</li>
				<br/>
				<div class="form-group">
					<button type="button" id="btn_reset_info" class="btn">修改并保存</button>
					<button type="reset" class="btn">重置</button>
				</div>
			</ul>
	  	</div>
	</form>
  </div>

	<div id="address" style="display: none" >
		<h2>收获地址</h2>
		<h4 style="color: #d43f3a">新增收获地址</h4>
		<form action="#" >
			<div class="content">
				<ul>
					<li>
						收货人姓名:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="add_name">
					</li>
					<br/>
					<li>
						收货人手机:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="add_tel">
					</li>
					<br/>
					<li>
						收货人省份:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="add_pro">
					</li>
					<br/>
					<li>
						收货人城市:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="add_city">
					</li>
					<br/>
					<li>
						详细的地址:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="add_area">
					</li>
					<br/>
					<div class="form-group">
						<button type="button" id="btn_add_address" class="btn">保存收获地址</button>
						<button type="reset" class="btn">重置输入</button>
					</div>
				</ul>
			</div>
		</form>
	</div>

	<div id="address_detail" style="display: none">
		<br/>
		<h4>已保存地址如下：</h4>
		<table class="table table-bordered table-striped table-hover">
			<thead>
			<tr>
				<td>收货人</td>
				<td>省份</td>
				<td>城市</td>
				<td>详细地址</td>
				<td>手机号</td>
				<td>操作</td>
			</tr>
			</thead>
			<tbody id="tbody">

			</tbody>
		</table>
	</div>
</div>

<!-- 删除的模态框 -->
<div class="modal fade" tabindex="-1" role="dialog" id="delModal">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">提示</h4>
			</div>
			<div class="modal-body">
				<p>你确定删除:"</p>
				<p hidden="hidden" id="del_rec"></p>
				<p id="del_area"></p>
				<p>"这条地址吗？</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-primary" onclick="doDelete()">确定</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- 修改的模态框 -->
<div class="modal fade" tabindex="-1" role="dialog" id="editModal">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">提示</h4>
			</div>
			<div class="modal-body">
				<input type="hidden" id="edit_id">
				<form class="form-horizontal">
					<div class="form-group form-group-lg">
						<label class="control-label col-lg-2">收货人姓名:</label>
						<div class="col-lg-8">
							<input type="text" name="rec_name" id="rec_name" class="form-control">
						</div>
					</div>
					<div class="form-group form-group-lg">
						<label class="control-label col-lg-2">收货地省份:</label>
						<div class="col-lg-8">
							<input type="text" name="no" id="rec_prov" class="form-control">
						</div>
					</div>
					<div class="form-group form-group-lg">
						<label class="control-label col-lg-2">收货地城市:</label>
						<div class="col-lg-8">
							<input type="text" name="no" id="rec_city" class="form-control">
						</div>
					</div>
					<div class="form-group form-group-lg">
						<label class="control-label col-lg-2">详细地址:</label>
						<div class="col-lg-8">
							<input type="text" name="name" id="rec_area" class="form-control">
						</div>
					</div>
					<div class="form-group form-group-lg">
						<label class="control-label col-lg-2">收货人电话:</label>
						<div class="col-lg-8">
							<input type="text" name="name" id="rec_tel" class="form-control">
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-primary" onclick="doEdit()">确定</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

</body>
<script src="jquery/jquery-3.4.1.min.js"></script>
<script src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<script type="text/javascript">
	$("#top_page").load("top.html");
	var cur_user_id;
	getStatus();
	function getStatus()
	{
		var cookies=document.cookie.split(";");
		for(var i=0;i<cookies.length;i++)
		{
			var cookie=cookies[i].trim();
			if(cookie.indexOf("info")==0)
			{
				var m=cookie.substring("info".length+1);
				m = m.substring(3);
				m = m.substring(0,m.length-4);
				jQuery.post("/findIdByName",{"user_name":m},function (rst) {
					cur_user_id = rst;
				},"json");
				console.log(cur_user_id);
				return;
			}
		}
	}

	jQuery(function(){
		//页面加载完毕，就去数据库中获取数据
		jQuery.post("/findAllAddress",{"user_id": cur_user_id},function(rst){//处理响应的结果
			var body="";
			for(var i=0;i<rst.length;i++)
			{
				var json=rst[i];//{"receiver_name":叶宇航,"province":"浙江","city_name":'',"area":"","number":""}
				body+="<tr>";
				body+="<td>"+json.receiver_name+"</td>";
				body+="<td>"+json.province+"</td>";
				body+="<td>"+json.city_name+"</td>";
				body+="<td>"+json.area_name+"</td>";
				body+="<td>"+json.number+"</td>";
				body+="<td>";
				body+="<a href='#' onclick='showDelModal(\""+json.receiver_name+"\",\""+json.area_name+"\")'>删除</a>&nbsp;&nbsp;";
				body+="<a href='#' onclick='showEditModal(\""
						+json.add_id+"\",\""
						+json.receiver_name+"\",\""
						+json.province+"\",\""
						+json.city_name+"\",\""
						+json.area_name+"\",\""
						+json.number+"\")'>修改</a>";
				body+="</td>"
				body+="</tr>";
			}
			jQuery("#tbody").html(body);
		},"json");//表示返回数据的格式
	});

	jQuery(function(){
		//页面加载完毕，就去数据库中获取数据
		jQuery.post("/findUserDetails",{"user_id": cur_user_id},function(rst){//处理响应的结果
			jQuery("#u_name").val(rst.name);
			jQuery("#u_pwd").val(rst.password);
			jQuery("#u_tel").val(rst.number);
			jQuery("#u_sex").val(rst.sex);
			jQuery("#u_email").val(rst.email);
		},"json");//表示返回数据的格式
	});

	//如果是通过function定义的方法必须在jquery外面写
	function showDelModal(receiver,area)
	{
		jQuery("#del_rec").html(receiver);
		jQuery("#del_area").html(area);
		jQuery("#delModal").modal("show");
	}

	function doDelete() {
		jQuery("#delModal").modal("hide");
		var u_name = jQuery("#del_rec").html();
		var u_area = jQuery("#del_area").html();
		jQuery.post("/deleteAddress",{"u_id":cur_user_id, "u_name":u_name, "u_area":u_area}, function (rst) {
			alert(rst);
			if (rst == "删除成功") {
				location.reload();
			}
		})
	}

	function showEditModal(add_id,receiver,province,city,area,number)
	{
		jQuery("#edit_id").val(add_id);
		jQuery("#rec_name").val(receiver);
		jQuery("#rec_prov").val(province);
		jQuery("#rec_city").val(city);
		jQuery("#rec_area").val(area);
		jQuery("#rec_tel").val(number);
		jQuery("#editModal").modal("show");
	}
	function doEdit() {
		jQuery("#editModal").modal("hide");
		var add_id = jQuery("#edit_id").val();
		var u_name = jQuery("#rec_name").val();
		var u_tel = jQuery("#rec_tel").val();
		var u_prov = jQuery("#rec_prov").val();
		var u_city = jQuery("#rec_city").val();
		var u_area = jQuery("#rec_area").val();
		jQuery.post("/updateAddress", {"add_id":add_id, "u_name":u_name,"u_tel":u_tel,"u_prov":u_prov,"u_city":u_city,"u_area":u_area},function (rst) {
			alert(rst);
			if (rst == "修改成功") {
				location.reload();
			}
		})
	}
	function showInfo() {
		jQuery("#information").css("display","inline");
		jQuery("#address").css("display","none");
		jQuery("#address_detail").css("display","none");
	}
	function showAddr() {
		jQuery("#information").css("display","none");
		jQuery("#address").css("display","inline");
		jQuery("#address_detail").css("display","inline");
	}

	jQuery(function(){
		jQuery("#btn_add_address").click(function(){
			var u_name=jQuery("#add_name").val();
			var u_tel=jQuery("#add_tel").val();
			var u_prov=jQuery("#add_pro").val();
			var u_city=jQuery("#add_city").val();
			var u_area=jQuery("#add_area").val();
			jQuery.post("/addUserAddress",{"u_id":cur_user_id,"u_name":u_name,"u_tel":u_tel,"u_prov":u_prov,
				"u_city":u_city,"u_area":u_area},function (rst) {
				if(rst=="添加成功")
				{
					alert(rst);
					location.reload();
				}else{
					alert(rst);
				}
			});
		});
	});

	jQuery(function(){
		jQuery("#btn_reset_info").click(function(){
			var u_name=jQuery("#u_name").val();
			var u_tel=jQuery("#u_tel").val();
			var u_pwd=jQuery("#u_pwd").val();
			var u_email=jQuery("#u_email").val();
			var u_sex=jQuery("#u_sex").val();
			jQuery.post("/updateUserInfo",{"u_id":cur_user_id,"u_name":u_name,"u_tel":u_tel,"u_pwd":u_pwd,
				"u_email":u_email,"u_sex":u_sex},function (rst) {
				if(rst=="修改成功")
				{
					alert(rst);
					location.reload();
				}else{
					alert(rst);
				}
			});
		});
	});
</script>
</html>